{"componentChunkName":"component---src-templates-blog-post-js","path":"/corss-browser-glass-navbar/","result":{"data":{"site":{"siteMetadata":{"title":"Luis Ball"}},"markdownRemark":{"id":"1dec38e4-ff4b-58f7-85aa-3c1fdbca6c73","excerpt":"The goal is to recreate the apple.com menubar. They do some fancy blur effects that are not supported in FireFox at the moment. safari-vs-firefox-blur-glass…","html":"<p>The goal is to recreate the <a href=\"www.apple.com\">apple.com</a> menubar. They do some fancy blur effects that are not supported in FireFox at the moment.</p>\n<p><img src=\"https://i.imgur.com/f1bFaBu.png\" alt=\"safari-vs-firefox-blur-glass-menubar\"></p>\n<p>As you can see in the image above, non-WebKit browsers like Firefox don’t support the <code class=\"language-text\">backdrop-filter</code> CSS property as of right now. In order to achieve something like the cross-browser compatible example bellow, we therefore have to do some CSS and Js tricker.</p>\n<h2>Cross-browser compatible example</h2>\n<iframe height=\"399\" style=\"width: 100%;\" scrolling=\"no\" title=\"YzwwzWV\" src=\"https://codepen.io/luqven/embed/YzwwzWV?height=399&theme-id=dark&default-tab=css,result&editable=true\" frameborder=\"no\" allowtransparency=\"true\" allowfullscreen=\"true\">\n  See the Pen <a href='https://codepen.io/luqven/pen/YzwwzWV'>YzwwzWV</a> by Luis Ball\n  (<a href='https://codepen.io/luqven'>@luqven</a>) on <a href='https://codepen.io'>CodePen</a>.\n</iframe>\n<h2>Blurred-glass menu bar in WebKit Browsers</h2>\n<p>Achieving this effect in a webkit browser is fairly simple. We just need to add a css class to the navigation bar with a <code class=\"language-text\">backdrop-filter</code> property:</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\">    <span class=\"token atrule\"><span class=\"token rule\">@supports</span> <span class=\"token punctuation\">(</span><span class=\"token property\">backdrop-filter</span><span class=\"token punctuation\">:</span> <span class=\"token function\">blur</span><span class=\"token punctuation\">(</span>12px<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token selector\">.blurred</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">backdrop-filter</span><span class=\"token punctuation\">:</span> <span class=\"token function\">saturate</span><span class=\"token punctuation\">(</span>180 %<span class=\"token punctuation\">)</span> <span class=\"token function\">blur</span><span class=\"token punctuation\">(</span>13px<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token selector\">.nav</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">background-color</span><span class=\"token punctuation\">:</span> #5d5d5dc2<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>Where it gets tricky is implementing the same effect on the menu bar in browsers without support for <code class=\"language-text\">backdrop-filter</code>. So to re-create the translucency, you have to get a little creative.</p>\n<h2>Blur effects in non-webkit browsers</h2>\n<p>First off, creating a <code class=\"language-text\">blurred-glass</code> filter in FireFox requires us to use a <code class=\"language-text\">&lt;svg&gt;</code> element trick. Essentially, a semi-transparent <code class=\"language-text\">&lt;svg /&gt;</code> with a <code class=\"language-text\">&lt;feGaussianBlur /&gt;</code> property is placed somewhere on the page.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">    <span class=\"token comment\">// svg element with blur filter applied</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>svg</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>svg-image-blur<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>filter</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>blur-effect<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>feGaussianBlur</span> <span class=\"token attr-name\">stdDeviation</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>10<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>filter</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>svg</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Then, its id gets referenced in the CSS as a <code class=\"language-text\">filter</code> for the element that’s being blurred.</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\">    <span class=\"token comment\">/* css property referencing that element as the filter */</span>\n    <span class=\"token selector\">.blurred-content</span> <span class=\"token punctuation\">{</span>\n        ...\n        <span class=\"token property\">filter</span><span class=\"token punctuation\">:</span> <span class=\"token url\"><span class=\"token function\">url</span><span class=\"token punctuation\">(</span>#blur-effect<span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>It’s quite common to see this trick in used in the wild for projects like lazy image loader libraries that blur an image while it’s loading. The effect is often achieved is often by:</p>\n<ol>\n<li>duplicating an element on-top of the original</li>\n<li>blurring the duplicate</li>\n<li>lowering the opacity of the duplicate</li>\n</ol>\n<p>Generally, this approach works well for static elements whose background and / or image attributes won’t be changing anytime soon. But what about our menu bar?</p>\n<h2>Re-creating <code class=\"language-text\">backdrop-filer</code> effects to achieve blurring</h2>\n<p>A menu bar only blurs what’s scrolled beneath it, making it difficult to know for sure what content will end up needing the effect. What’s more, the content of the page varies unpredictably in size, color, and scale.</p>\n<p>Web-kit browsers solved this problem by introducing the <code class=\"language-text\">backdrop-filter</code> CSS property. It essentially mimics the behavior outlined above, where the entire content of the DOM element’s siblings and children are duplicated and then blurred. FireFox doesn’t support <code class=\"language-text\">backdrop-filter</code> as of right now, and yet, it turns out the approach is very similar.</p>\n<p>To re-create the webkit <code class=\"language-text\">backdrop-filter</code> filter property in FireFox, what we do is:</p>\n<ol>\n<li>duplicate the entire site’s content (excluding the menu bar of course)</li>\n<li>blur the container using the svg filter trick outlined above</li>\n<li>place it in a container element and</li>\n<li>put that container inside the navbar’s container.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    <span class=\"token comment\">// select the html element we want to blur</span>\n    <span class=\"token keyword\">const</span> blurTarget <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.blur-target'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// duplicate it</span>\n    <span class=\"token keyword\">const</span> duplicate <span class=\"token operator\">=</span> blurTarget<span class=\"token punctuation\">.</span><span class=\"token function\">cloneNode</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// place it inside a container-div</span>\n    <span class=\"token keyword\">const</span> targetBlurred <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'div'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// apply blurring svg effect to the container</span>\n    targetBlurred<span class=\"token punctuation\">.</span>className <span class=\"token operator\">=</span> <span class=\"token string\">'blurred-content'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// place duplicate inside the container</span>\n    targetBlurred<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>duplicate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    <span class=\"token comment\">// place our blurred duplicate inside the nav bar</span>\n    <span class=\"token keyword\">const</span> navContainer <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.nav-container'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    navContainer<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>targetBlurred<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </code></pre></div>\n<p>Finally, we set the blurred copy’s <code class=\"language-text\">z-index</code> bellow that of the menubar. Note that in order to avoid blurring the contents outside the menu bar, its container needs to have the <code class=\"language-text\">overflow: hiddenproperty</code> set.</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\">    <span class=\"token selector\">// navbar container element\n    .nav-container</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">position</span><span class=\"token punctuation\">:</span> fixed<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">top</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> 100vw<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> 50px<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">box-shadow</span><span class=\"token punctuation\">:</span>0 1px 0 <span class=\"token function\">rgba</span><span class=\"token punctuation\">(</span>0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">,</span> .1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> 0 1px 2px <span class=\"token function\">rgba</span><span class=\"token punctuation\">(</span>0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">,</span> .1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token property\">z-index</span><span class=\"token punctuation\">:</span> 2<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">overflow</span><span class=\"token punctuation\">:</span> hidden<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    // apply non-web-kit styling if backdrop-filter not supported\n    <span class=\"token atrule\"><span class=\"token rule\">@supports</span> not <span class=\"token punctuation\">(</span><span class=\"token property\">backdrop-filter</span><span class=\"token punctuation\">:</span> <span class=\"token function\">blur</span><span class=\"token punctuation\">(</span>12px<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></span> <span class=\"token punctuation\">{</span>\n        // duplicate<span class=\"token selector\">'s container\n        .blurred-content</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">padding</span><span class=\"token punctuation\">:</span>0 1rem<span class=\"token punctuation\">;</span>\n            <span class=\"token property\">padding-top</span><span class=\"token punctuation\">:</span> 20px<span class=\"token punctuation\">;</span>\n            <span class=\"token property\">position</span><span class=\"token punctuation\">:</span> absolute<span class=\"token punctuation\">;</span>\n            <span class=\"token property\">top</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n            <span class=\"token property\">left</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n            <span class=\"token property\">right</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n            <span class=\"token property\">filter</span><span class=\"token punctuation\">:</span> <span class=\"token url\"><span class=\"token function\">url</span><span class=\"token punctuation\">(</span>#blur-effect<span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">;</span>\n            <span class=\"token property\">opacity</span><span class=\"token punctuation\">:</span> 0.3<span class=\"token punctuation\">;</span>\n            <span class=\"token property\">z-index</span><span class=\"token punctuation\">:</span> 3<span class=\"token punctuation\">;</span>\n            <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> 50px<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>There’s a catch however. The blurred copy of the page doesn’t scroll when the page does out-of-the-box. We have to do some JavaScript trickery to get the blurred copy to scroll at the same speed and maintain the illusion of the transparency effect.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    <span class=\"token comment\">// whenever out page content scrolls, move tbe duplicate</span>\n    <span class=\"token keyword\">const</span> contentWrapper <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#content'</span><span class=\"token punctuation\">)</span>\n    window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'scroll'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        duplicate<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>marginTop <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>scrollY <span class=\"token operator\">+</span> <span class=\"token string\">'px'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Summary</h2>\n<p>In short, it’s not pretty. In fact it can also significantly reduce the scrolling frame-rates, especially for longer and more complex pages. And, while there are some approaches out there that address this by inserting the blurred duplicate in an <code class=\"language-text\">&lt;iframe /&gt;</code> for instance, the fact is that things shouldn’t be this hard.</p>\n<p>And if you’re thinking, <em>“This sounds like we’ve essentially duplicated the steps outlined in the <code class=\"language-text\">backdrop-filter</code> specs”</em>, you’re absolutely right. Unlike the spec, however, we can’t <em>“Copy the Backdrop Root Image into a temporary buffer”</em>. We don’t have access to that buffer, which is why we have to copy the actual HTML DOM elements in full, place them in a container, and then blur them all in unison by blurring the container.</p>\n<p>Thankfully, it looks like most modern browsers are embracing the webkit <code class=\"language-text\">backdrop-filter</code> css property. Chrome starting supporting it since version 81 and FireFox is said to be supporting it within the next major release or two.</p>\n<blockquote>\n<p>Updated on 2020-06-09 | 17:52</p>\n</blockquote>","frontmatter":{"title":"How to make a cross-browser, blurred-glass menu bar","date":"June 08, 2020","description":"Recreating Apple's menubar in a non-webkit browser using CSS and JavaScript"}}},"pageContext":{"slug":"/corss-browser-glass-navbar/","previous":{"fields":{"slug":"/intro/"},"frontmatter":{"title":"About me"}},"next":{"fields":{"slug":"/gatsby-gh-pages/"},"frontmatter":{"title":"How to publish a Gatsby site to GitHub Pages"}}}}}