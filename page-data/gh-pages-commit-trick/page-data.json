{"componentChunkName":"component---src-templates-blog-post-js","path":"/gh-pages-commit-trick/","result":{"data":{"site":{"siteMetadata":{"title":"Luis Ball"}},"markdownRemark":{"id":"66a5b6f9-b5b2-5f7f-8fe2-95d0c97c8421","excerpt":"Until recently I hadn’t bothered to look at how the  package was titling the commits. Turns out, it was just as a super unhelpful . Yikes. So over lunch I…","html":"<p>Until recently I hadn’t bothered to look at how the <code class=\"language-text\">gh-pages</code> package was titling the commits. Turns out, it was just as a super unhelpful <code class=\"language-text\">Updates</code>. Yikes.</p>\n<p>So over lunch I poured over the docs only to find they have an API that allows you change this. Nice! All you need to do is use the <code class=\"language-text\">--message</code> flag.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">gh-pages -d public -b main --message <span class=\"token variable\">$SOME_MESSAGE</span></code></pre></div>\n<p>Problem is I don’t want yet another unhelpful commit tittle. Instead, I’d like at least some context of what’s being changed to be passed in.</p>\n<p>Although not perfect, the last commit message from <code class=\"language-text\">master-source</code> branch will have this.</p>\n<h2>Use the last commit from the current branch as the gh-pages commit message</h2>\n<p>We can add the last commit message to the <code class=\"language-text\">--message</code> flag by using git’s <code class=\"language-text\">log</code> and <code class=\"language-text\">pretty</code> APIs.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># outputs last commit title in one line</span>\n<span class=\"token function\">git</span> log -1 --pretty<span class=\"token operator\">=</span>%B</code></pre></div>\n<p>If we save that to a variable, <code class=\"language-text\">$DEPLOY_MESSAGE</code>, we can reference it in <code class=\"language-text\">package.json</code>’s <code class=\"language-text\">deploy</code> script.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"deploy\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"DEPLOY_MESSAGE=\\\"$(git log -1 --pretty=%B)\\\"; gatsby build &amp;&amp; cp CNAME public &amp;&amp; gh-pages -d public -b master --message $DEPLOY_MESSAGE\"</span></code></pre></div>\n<h2>The catch</h2>\n<p>This is almost perfect, <em>except</em> because there’s empty spaces in the commit title, the <code class=\"language-text\">package.json</code> script will not pass the entire commit to the <code class=\"language-text\">--message</code> flag for <code class=\"language-text\">gh-pages</code>.</p>\n<p>So you’d end up with a commit message like this,</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">chore:</code></pre></div>\n<p>instead of this</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">chore: add deploy script variables</code></pre></div>\n<h2>Lets fix it</h2>\n<p>It’s an easy fix. All we need to do is replace the empty character, <code class=\"language-text\">‏‏‎ ‎</code>, in the <code class=\"language-text\">$DEPLOY_MESSAGE</code> variable with something else, like <code class=\"language-text\">_</code>.</p>\n<p>We can do this in bash using pattern substitution.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\">## ${parameter/pattern/string}</span>\n\n<span class=\"token assign-left variable\">DEPLOY_MESSAGE</span><span class=\"token operator\">=</span><span class=\"token punctuation\">\\</span>\"<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">git</span> log -1 --pretty<span class=\"token operator\">=</span>%B<span class=\"token variable\">)</span></span><span class=\"token punctuation\">\\</span>\"<span class=\"token punctuation\">;</span>\n<span class=\"token assign-left variable\">RESULT</span><span class=\"token operator\">=</span><span class=\"token variable\">${DEPLOY_MESSAGE<span class=\"token operator\">/</span><span class=\"token operator\">/</span> <span class=\"token operator\">/</span>_}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>And that’s it! Just update the <code class=\"language-text\">deploy</code> script with that pattern and you’re all set.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"deploy\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"DEPLOY_MESSAGE=\\\"$(git log -1 --pretty=%B)\\\"; RESULT=${DEPLOY_MESSAGE// /_}; gatsby build &amp;&amp; cp CNAME public &amp;&amp; gh-pages -d public -b master --message $RESULT\"</span></code></pre></div>\n<p>Now your commit messages can give you some context about what your last gh-pages push changed.</p>","frontmatter":{"title":"How to make the last commit message your gh-pages commit message","date":"May 19, 2021","description":"Quick trick to add meaningful commits to gh-pages"}}},"pageContext":{"slug":"/gh-pages-commit-trick/","previous":{"fields":{"slug":"/request-animation-frame-versus-request-idle-callback/"},"frontmatter":{"title":"Best practices for requestIdleCallback and requestAnimationFrame in 2021"}},"next":null}}}